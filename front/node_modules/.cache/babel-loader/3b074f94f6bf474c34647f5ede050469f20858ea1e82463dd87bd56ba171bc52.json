{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useRef, useEffect } from 'react';\nimport { useDJConsole } from './DJConsoleContext';\nconst useSound = soundUrl => {\n  _s();\n  const audioRef = useRef(null);\n  const isPlayingRef = useRef(false);\n  const playPromiseRef = useRef(null);\n  const {\n    volume\n  } = useDJConsole();\n  useEffect(() => {\n    // Create audio element if it doesn't exist\n    if (!audioRef.current) {\n      audioRef.current = new Audio(soundUrl);\n      audioRef.current.loop = true;\n      audioRef.current.preload = 'auto';\n      audioRef.current.volume = volume;\n    }\n\n    // Cleanup on unmount\n    return () => {\n      stop();\n      audioRef.current = null;\n    };\n  }, [soundUrl]);\n  useEffect(() => {\n    if (audioRef.current) {\n      audioRef.current.volume = volume;\n    }\n  }, [volume]);\n  const stop = useCallback(() => {\n    if (audioRef.current) {\n      if (playPromiseRef.current) {\n        playPromiseRef.current.then(() => {\n          audioRef.current.pause();\n          audioRef.current.currentTime = 0;\n          isPlayingRef.current = false;\n        }).catch(() => {\n          isPlayingRef.current = false;\n        });\n      } else {\n        audioRef.current.pause();\n        audioRef.current.currentTime = 0;\n        isPlayingRef.current = false;\n      }\n    }\n  }, []);\n  const play = useCallback(() => {\n    if (!isPlayingRef.current && audioRef.current) {\n      // Ensure the latest volume is set\n      audioRef.current.volume = volume;\n\n      // Store the play promise\n      const playPromise = audioRef.current.play();\n      if (playPromise !== undefined) {\n        playPromiseRef.current = playPromise;\n        playPromise.then(() => {\n          isPlayingRef.current = true;\n          if (playPromiseRef.current === playPromise) {\n            playPromiseRef.current = null;\n          }\n        }).catch(err => {\n          console.error(\"Audio play error:\", err);\n          isPlayingRef.current = false;\n          if (playPromiseRef.current === playPromise) {\n            playPromiseRef.current = null;\n          }\n        });\n      } else {\n        isPlayingRef.current = true;\n      }\n    }\n  }, [volume]); // Include volume in dependencies\n\n  return {\n    play,\n    stop,\n    isPlaying: isPlayingRef.current\n  };\n};\n_s(useSound, \"6f3hGOK1q6LQw1o8Oy3MEXc1CN8=\", false, function () {\n  return [useDJConsole];\n});\nexport default useSound;","map":{"version":3,"names":["useRef","useEffect","useDJConsole","useSound","soundUrl","_s","audioRef","isPlayingRef","playPromiseRef","volume","current","Audio","loop","preload","stop","useCallback","then","pause","currentTime","catch","play","playPromise","undefined","err","console","error","isPlaying"],"sources":["/home/leabrun/python_/KWORK/dj/front/src/useSound.jsx"],"sourcesContent":["import { useRef, useEffect } from 'react';\nimport { useDJConsole } from './DJConsoleContext';\n\nconst useSound = (soundUrl) => {\n  const audioRef = useRef(null);\n  const isPlayingRef = useRef(false);\n  const playPromiseRef = useRef(null);\n\n  const { volume } = useDJConsole();\n\n  useEffect(() => {\n    // Create audio element if it doesn't exist\n    if (!audioRef.current) {\n      audioRef.current = new Audio(soundUrl);\n      audioRef.current.loop = true;\n      audioRef.current.preload = 'auto';\n      audioRef.current.volume = volume;\n    }\n\n    // Cleanup on unmount\n    return () => {\n      stop();\n      audioRef.current = null;\n    };\n  }, [soundUrl]);\n\n  useEffect(() => {\n    if (audioRef.current) {\n      audioRef.current.volume = volume;\n    }\n  }, [volume]);\n\n  const stop = useCallback(() => {\n    if (audioRef.current) {\n      if (playPromiseRef.current) {\n        playPromiseRef.current\n          .then(() => {\n            audioRef.current.pause();\n            audioRef.current.currentTime = 0;\n            isPlayingRef.current = false;\n          })\n          .catch(() => {\n            isPlayingRef.current = false;\n          });\n      } else {\n        audioRef.current.pause();\n        audioRef.current.currentTime = 0;\n        isPlayingRef.current = false;\n      }\n    }\n  }, []);\n\n  const play = useCallback(() => {\n    if (!isPlayingRef.current && audioRef.current) {\n      // Ensure the latest volume is set\n      audioRef.current.volume = volume;\n      \n      // Store the play promise\n      const playPromise = audioRef.current.play();\n      if (playPromise !== undefined) {\n        playPromiseRef.current = playPromise;\n        \n        playPromise\n          .then(() => {\n            isPlayingRef.current = true;\n            if (playPromiseRef.current === playPromise) {\n              playPromiseRef.current = null;\n            }\n          })\n          .catch(err => {\n            console.error(\"Audio play error:\", err);\n            isPlayingRef.current = false;\n            if (playPromiseRef.current === playPromise) {\n              playPromiseRef.current = null;\n            }\n          });\n      } else {\n        isPlayingRef.current = true;\n      }\n    }\n  }, [volume]); // Include volume in dependencies\n\n  return { \n    play, \n    stop, \n    isPlaying: isPlayingRef.current \n  };\n};\n\nexport default useSound;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}